# SQL开发优化参考
---

本文介绍在使用和基于GreatSQL数据库进行业务系统应用开发时建议遵循的SQL开发优化参考。

1. 想要在应用开发中让业务SQL获得更高性能，注意遵循几个核心原则：
	- 窄表好：数据类型够用就好，保持高效。
	- 小表好：数据冷热分离，只留最新热数据。
	- 请求快：每个事务/请求效率足够高，不阻塞。
	- 请求少：从产品需求端削减不必要的请求，动态请求静态化或降频；也要减少对数据库的额外请求，例如在数据库层做额外分组、排序。

1. 默认不要采用 `SELECT *` 一次取出所有列，只取必要的列，如果确实需要读取所有列则考虑在只读从节点上查询。

1. 在一条SQL或一个事务中，不要一次性读写太多数据，通常建议不要超过1万行，降低每次请求的代价。

1. 需要随机取值时，不要直接运行 `ORDER BY RAND()`，改用优化后的方法，可参考文章：[提高MySQL RAND随机排序效率](https://mp.weixin.qq.com/s/SXRXzvuQDmuG99qfpfWwzQ)。

1. 不要执行 `LIKE '%search%'` 全模糊匹配搜索，改成 `LIKE 'search%'` 搜索，才能用上索引。

1. 对InnoDB表执行 `COUNT(*)` 效率低，尤其是不带WHERE条件时，要少用，可以改成求概数，或者采用其他外部计数器。

1. 统计查询 `COUNT(*)` 和 `COUNT(N)` 并没本质区别，但后者不是常见写法，因此不推荐使用，容易造成混淆；而 `COUNT(fieldN)` 则不同，尤其是当列定义允许NULL时，会逐行扫描，跳过值为NULL的行。

1. 分页查询中当页码很大时，不要简单 `LIMIT M,N`，而是改用延迟关联优化思路，可参考文章：[高性能分页查询方法](https://mp.weixin.qq.com/s/Et4nkoawfre_LjPX5kNl8g)、[分页优化](https://mp.weixin.qq.com/s/61SkNCiyebLYOXN3qaAnxw)。

1. 多表JOIN时，务必注意驱动表选择是否最优，分组/排序列是否属于驱动表。

1. 多表JOIN时，注意规避类型隐式转换造成无法使用索引。

1. 多个查询结果如果不需要去重的话，可以采用 `UNION ALL` 代替 `UNION`，因为用 `UNION ALL`不需要产生外的临时表。

1. 大部分时候，分库分表并不是必须的，也不存在超过一千万就要分表的硬性要求，关键还是要优化应用请求效率。


**问题反馈**
---
- [问题反馈 gitee](https://gitee.com/GreatSQL/GreatSQL-Doc/issues)


**联系我们**
---

扫码关注微信公众号

![输入图片说明](https://images.gitee.com/uploads/images/2021/0802/141935_2ea2c196_8779455.jpeg "greatsql社区-wx-qrcode-0.5m.jpg")
